<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ”¶è— | å£½è±å°‹å¯¶å·´</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="i18n.js"></script>
</head>
<body class="collection-page">
    <!-- é é¦– -->
    <header class="collection-header">
        <h1 data-i18n="collection.title">æˆ‘çš„æ”¶è—</h1>
        <p data-i18n="collection.subtitle">æ”¶é›†æ‰€æœ‰æ™¯é»,æˆç‚ºå£½è±æ¢éšªå¤§å¸«!</p>
        <div class="collection-stats">
            <div class="stat-item">
                <div class="stat-number" id="collectedCount">0</div>
                <div class="stat-label" data-i18n="collection.collected">å·²æ”¶é›†</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">16</div>
                <div class="stat-label" data-i18n="collection.total">ç¸½æ™¯é»</div>
            </div>
        </div>
    </header>

    <!-- æ™¯é»ç¶²æ ¼ -->
    <div class="collection-content">
	   <!-- èªè¨€åˆ‡æ›å™¨ -->
            <div class="language-switcher">
                <button id="languageBtn">ğŸŒ <span id="currentFlag">ğŸ‡¹ğŸ‡¼</span></button>
                <div id="languageDropdown" class="dropdown-menu">
                    <div class="language-option" data-lang="zh-TW">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</div>
                    <div class="language-option" data-lang="en">ğŸ‡ºğŸ‡¸ English</div>
                    <div class="language-option" data-lang="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</div>
                </div>
            </div>
        </div>
        <div class="collection-grid" id="collectionGrid">
            <!-- æ™¯é»å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

		<!-- åº•éƒ¨å°èˆª -->
	<nav class="bottom-nav">
		<div class="bottom-nav-container">
			<a href="game-home.html" class="nav-item active">
				<div class="nav-item-icon">
					<i class="fas fa-home"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.home">ä¸»é </span>
			</a>
			<a href="map.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-map"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.map">åœ°åœ–</span>
			</a>
			<a href="collection.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-book"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.collection">æ”¶è—</span>
			</a>
			<a href="profile.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-user"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.profile">å€‹äºº</span>
			</a>
			<a href="javascript:void(0)" class="nav-item" id="musicToggle" onclick="toggleMusic()" aria-pressed="false">
				<div class="nav-item-icon">
					<i id="musicToggleIcon" class="fas fa-volume-mute"></i>
				</div>
				<span class="nav-item-label" id="musicToggleLabel" data-i18n="music.turnOn">é–‹å•ŸéŸ³æ¨‚</span>
			</a>
				<!-- èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å™¨ï¼ˆéš±è—ï¼‰ -->
			   <div id="bgPlayer"></div>
			   <!-- å¼•ç”¨éŸ³æ¨‚æ§åˆ¶ JS -->
			   <script src="bg-music.js"></script>    
		</div>
	</nav>

    <script src="spots-data.js"></script>
    <script src="spots-i18n.js"></script>
    <script>
        // ç•¶å‰èªè¨€
        let currentLanguage = i18n.getCurrentLanguage();

        // å–å¾—è·¯ç·šæ¨™ç±¤ï¼ˆå¤šèªè¨€ï¼‰
        function getRouteLabel(route, lang) {
            const labels = {
                'zh-TW': {
                    'nature': 'è‡ªç„¶ç”Ÿæ…‹',
                    'culture': 'æ–‡åŒ–é«”é©—',
                    'special': 'ç‰¹è‰²é«”é©—'
                },
                'en': {
                    'nature': 'Nature',
                    'culture': 'Culture',
                    'special': 'Special'
                },
                'ja': {
                    'nature': 'è‡ªç„¶ç”Ÿæ…‹',
                    'culture': 'æ–‡åŒ–ä½“é¨“',
                    'special': 'ç‰¹è‰²ä½“é¨“'
                }
            };
            return labels[lang][route] || labels['zh-TW'][route];
        }

        // å–å¾—ç‹€æ…‹æ–‡å­—ï¼ˆå¤šèªè¨€ï¼‰
        function getStatusText(isCollected, isHidden, isUnlocked, lang) {
            const texts = {
                'zh-TW': {
                    collected: 'âœ“ å·²æ”¶é›†',
                    locked: 'ğŸ”’ æœªæ”¶é›†',
                    hiddenLocked: 'ğŸ”’ æœªè§£é–'
                },
                'en': {
                    collected: 'âœ“ Collected',
                    locked: 'ğŸ”’ Not Collected',
                    hiddenLocked: 'ğŸ”’ Locked'
                },
                'ja': {
                    collected: 'âœ“ åé›†æ¸ˆã¿',
                    locked: 'ğŸ”’ æœªåé›†',
                    hiddenLocked: 'ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­'
                }
            };
            
            if (isCollected) {
                return texts[lang].collected;
            } else if (isHidden && !isUnlocked) {
                return texts[lang].hiddenLocked;
            } else {
                return texts[lang].locked;
            }
        }

        // è¼‰å…¥æ”¶è—è³‡æ–™
        function loadCollection() {
            const collection = JSON.parse(localStorage.getItem('collection')) || [];
            const collectionGrid = document.getElementById('collectionGrid');
            
            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('collectedCount').textContent = collection.length;

            // è·¯ç·šé¡è‰²
            const routeColors = {
                'nature': '#66bb6a',
                'culture': '#ffa726',
                'special': '#42a5f5'
            };

            // å–å¾—å¤šèªè¨€æ™¯é»è³‡æ–™
            const localizedSpots = getAllLocalizedSpots(currentLanguage);

            // ç”Ÿæˆæ™¯é»å¡ç‰‡
            collectionGrid.innerHTML = '';
            localizedSpots.forEach(spot => {
                const isCollected = collection.some(c => c.id === spot.id);
                
                // æª¢æŸ¥éš±è—æ™¯é»è§£é–ç‹€æ…‹
                const isHidden = spot.isHidden || false;
                let isUnlocked = false;
                
                if (isHidden && spot.parentId) {
                    isUnlocked = collection.some(c => c.id === spot.parentId);
                }
                
                // éš±è—æ™¯é»çš„é¡¯ç¤ºåç¨±
                const displayName = (isHidden && !isUnlocked) ? spot.name : (spot.displayName || spot.name);
                
                // å¡ç‰‡ç‰¹æ®Šæ¨£å¼
                let cardExtraClass = '';
                if (isHidden && isCollected) {
                    cardExtraClass = 'hidden-unlocked';
                } else if (isHidden && !isUnlocked) {
                    cardExtraClass = 'hidden-locked';
                }
                
                const card = document.createElement('div');
                card.className = `spot-card ${cardExtraClass}`;
                
                // æ±ºå®šè¦é¡¯ç¤ºåœ–ç‰‡é‚„æ˜¯åœ–æ¨™
                let imageContent = '';
                if (isCollected && spot.image) {
                    // å·²æ”¶é›†ä¸”æœ‰åœ–ç‰‡ - é¡¯ç¤ºåœ–ç‰‡(ç™½è‰²èƒŒæ™¯)
                    imageContent = `
                        <div class="spot-image-container" style="position: relative; width: 100%; height: 240px; overflow: hidden; border-radius: 12px 12px 0 0; background: white; display: flex; align-items: center; justify-content: center;">
                            <img src="${spot.image}" alt="${displayName}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                            <div class="collected-badge" style="position: absolute; top: 10px; right: 10px;"><i class="fas fa-check-circle"></i></div>
                            ${(isHidden) ? '<div class="hidden-badge" style="position: absolute; top: 10px; left: 10px;">âœ¨</div>' : ''}
                        </div>
                    `;
                } else {
                    // æœªæ”¶é›†æˆ–æ²’æœ‰åœ–ç‰‡ - é¡¯ç¤ºåœ–æ¨™
                    imageContent = `
                        <div class="spot-image ${isCollected ? '' : 'locked'}" style="background: linear-gradient(135deg, ${routeColors[spot.route]}, ${routeColors[spot.route]}dd);">
                            <i class="fas ${(isHidden && !isUnlocked) ? 'fa-question' : spot.icon} fa-3x"></i>
                            ${!isCollected ? '<div class="lock-overlay"><i class="fas fa-lock"></i></div>' : ''}
                            ${isCollected ? '<div class="collected-badge"><i class="fas fa-check-circle"></i></div>' : ''}
                        </div>
                    `;
                }
                
                card.innerHTML = `
                    ${imageContent}
                    <div class="spot-info">
                        <h3 class="spot-name">${displayName}</h3>
                        <p class="spot-description">${spot.shortDesc}</p>
                        <div class="spot-meta">
                            <span class="route-tag" style="background: ${routeColors[spot.route]}20; color: ${routeColors[spot.route]};">
                                ${getRouteLabel(spot.route, currentLanguage)}
                            </span>
                            <span class="spot-status ${isCollected ? 'collected' : 'locked'}">
                                ${getStatusText(isCollected, isHidden, isUnlocked, currentLanguage)}
                            </span>
                        </div>
                    </div>
                `;
                
                // é»æ“Šå¡ç‰‡è·³è½‰åˆ°è©³æƒ…é 
                card.onclick = () => {
                    if (isHidden && !isUnlocked) {
                        const parentSpot = spotsData.find(s => s.id === spot.parentId);
                        const messages = {
                            'zh-TW': `ğŸ”’ é€™æ˜¯éš±è—æ™¯é»!\n\néœ€è¦å…ˆå®Œæˆã€Œ${parentSpot.name}ã€çš„æ‰“å¡æ‰èƒ½è§£é–å“¦!`,
                            'en': `ğŸ”’ This is a hidden spot!\n\nYou need to check in at "${parentSpot.name}" first to unlock it!`,
                            'ja': `ğŸ”’ ã“ã‚Œã¯éš ã—ã‚¹ãƒãƒƒãƒˆã§ã™!\n\nã€Œ${parentSpot.name}ã€ã§ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã—ã¦ã€ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã—ã¦ãã ã•ã„!`
                        };
                        alert(messages[currentLanguage] || messages['zh-TW']);
                        return;
                    }
                    window.location.href = `spot-detail.html?id=${spot.id}`;
                };
                
                collectionGrid.appendChild(card);
            });
        }

        // åˆå§‹åŒ–
        loadCollection();
    
        // èªè¨€åˆ‡æ›å™¨åŠŸèƒ½
        const languageBtn = document.getElementById('languageBtn');
        const languageDropdown = document.getElementById('languageDropdown');
        const currentFlag = document.getElementById('currentFlag');
        const languageOptions = document.querySelectorAll('.language-option');
        const languageFlags = {'zh-TW': 'ğŸ‡¹ğŸ‡¼', 'en': 'ğŸ‡ºğŸ‡¸', 'ja': 'ğŸ‡¯ğŸ‡µ'};
        
        if (languageBtn) {
            languageBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                languageDropdown.classList.toggle('show');
            });
            document.addEventListener('click', () => languageDropdown.classList.remove('show'));
        }
        
        languageOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = option.getAttribute('data-lang');
                i18n.setLanguage(lang);
                currentLanguage = lang;
                currentFlag.textContent = languageFlags[lang];
                languageOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                languageDropdown.classList.remove('show');
                
                // ğŸ¯ é‡æ–°è¼‰å…¥æ”¶è—åˆ—è¡¨
                loadCollection();
            });
        });
        
        const currentLang = i18n.getCurrentLanguage();
        currentFlag.textContent = languageFlags[currentLang];
        languageOptions.forEach(option => {
            if (option.getAttribute('data-lang') === currentLang) option.classList.add('active');
        });
    </script>
	
</body>
</html>
