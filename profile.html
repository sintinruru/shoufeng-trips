<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººè³‡æ–™ | å£½è±å°‹å¯¶å·´</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="i18n.js"></script>
</head>
<body class="collection-page">
    <!-- é é¦– -->
    <header class="collection-header">
        <div class="player-avatar" style="width: 100px; height: 100px; font-size: 50px; margin: 0 auto 20px;">
            <i class="fas fa-hiking" id="profileAvatarIcon"></i>
        </div>
        <h1 id="profileName">å†’éšªè€…</h1>
        <p><span data-i18n="game.level">ç­‰ç´š</span> <span id="profileLevel">1</span> <span data-i18n="profile.explorer">æ¢éšªå®¶</span></p>
        <div class="collection-stats" style="margin-top: 30px;">
            <div class="stat-item">
                <div class="stat-number" id="profileCollected">0</div>
                <div class="stat-label" data-i18n="profile.collected">å·²æ”¶é›†</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="profileExp">0</div>
                <div class="stat-label" data-i18n="profile.exp">ç¶“é©—å€¼</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="profileDays">0</div>
                <div class="stat-label" data-i18n="profile.adventureDays">å†’éšªå¤©æ•¸</div>
            </div>
        </div>
    </header>

    <!-- å…§å®¹å€ -->
    <div class="collection-content">
	 <!-- èªè¨€åˆ‡æ›å™¨ -->
    <div class="language-switcher">
        <button id="languageBtn">ğŸŒ <span id="currentFlag">ğŸ‡¹ğŸ‡¼</span></button>
        <div id="languageDropdown" class="dropdown-menu">
            <div class="language-option" data-lang="zh-TW">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</div>
            <div class="language-option" data-lang="en">ğŸ‡ºğŸ‡¸ English</div>
            <div class="language-option" data-lang="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</div>
        </div>
    </div>
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <!-- æˆå°±å€å¡Š -->
            <div style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.08);">
                <h2 style="font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-trophy" style="color: #ffa726;"></i>
                    <span data-i18n="profile.achievements">æˆå°±å¾½ç« </span>
                </h2>
                <div id="achievementsList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <!-- æˆå°±å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æœ€è¿‘æ”¶é›† -->
            <div style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.08);">
                <h2 style="font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-clock" style="color: #42a5f5;"></i>
                    <span data-i18n="profile.recentCollections">æœ€è¿‘æ”¶é›†</span>
                </h2>
                <div id="recentCollections">
                    <!-- æœ€è¿‘æ”¶é›†å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="resetProgress()">
                    <i class="fas fa-redo"></i>
                    <span data-i18n="profile.resetProgress">é‡ç½®é€²åº¦</span>
                </button>
                <button class="btn btn-primary" style="flex: 1;" onclick="location.href='chat.html'">
                    <i class="fas fa-robot"></i>
                    <span data-i18n="profile.aiAssistant">AI åŠ©æ‰‹</span>
                </button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
	<nav class="bottom-nav">
		<div class="bottom-nav-container">
			<a href="game-home.html" class="nav-item active">
				<div class="nav-item-icon">
					<i class="fas fa-home"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.home">ä¸»é </span>
			</a>
			<a href="map.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-map"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.map">åœ°åœ–</span>
			</a>
			<a href="collection.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-book"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.collection">æ”¶è—</span>
			</a>
			<a href="profile.html" class="nav-item">
				<div class="nav-item-icon">
					<i class="fas fa-user"></i>
				</div>
				<span class="nav-item-label" data-i18n="nav.profile">å€‹äºº</span>
			</a>
			<a href="javascript:void(0)" class="nav-item" id="musicToggle" onclick="toggleMusic()" aria-pressed="false">
				<div class="nav-item-icon">
					<i id="musicToggleIcon" class="fas fa-volume-mute"></i>
				</div>
				<span class="nav-item-label" id="musicToggleLabel" data-i18n="music.turnOn">é–‹å•ŸéŸ³æ¨‚</span>
			</a>
				<!-- èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å™¨ï¼ˆéš±è—ï¼‰ -->
			   <div id="bgPlayer"></div>
			   <!-- å¼•ç”¨éŸ³æ¨‚æ§åˆ¶ JS -->
			   <script src="bg-music.js"></script>    
		</div>
	</nav>

    <script>
        // ç•¶å‰èªè¨€
        let currentLanguage = i18n.getCurrentLanguage();

        // é ­åƒåœ–æ¨™å°æ‡‰
        const avatarIcons = {
            'hiker': 'fa-hiking',
            'cyclist': 'fa-biking',
            'photographer': 'fa-camera',
            'explorer': 'fa-compass',
            'backpacker': 'fa-backpack',
            'traveler': 'fa-suitcase-rolling',
            'nature-lover': 'fa-leaf',
            'star': 'fa-star'
        };

        // æˆå°±ç³»çµ±
        const achievements = [
            { id: 'first-spot', i18nKey: 'achievement.firstSpot', icon: 'fa-map-marker-alt', requirement: 1 },
            { id: 'half-way', i18nKey: 'achievement.halfWay', icon: 'fa-hiking', requirement: 4 },
            { id: 'master', i18nKey: 'achievement.master', icon: 'fa-crown', requirement: 8 },
            { id: 'nature-lover', i18nKey: 'achievement.natureLover', icon: 'fa-leaf', requirement: 'nature-complete' },
            { id: 'culture-explorer', i18nKey: 'achievement.cultureExplorer', icon: 'fa-torii-gate', requirement: 'culture-complete' },
            { id: 'special-hunter', i18nKey: 'achievement.specialHunter', icon: 'fa-star', requirement: 'special-complete' }
        ];

        // å–å¾—æˆå°±åç¨±ï¼ˆå¤šèªè¨€ï¼‰
        function getAchievementName(i18nKey) {
            return i18n.t(i18nKey);
        }

        // è¼‰å…¥å€‹äººè³‡æ–™
        function loadProfile() {
            const playerData = JSON.parse(localStorage.getItem('player'));
            const collection = JSON.parse(localStorage.getItem('collection')) || [];
            
            if (!playerData) {
                window.location.href = 'create-character.html';
                return;
            }

            // é¡¯ç¤ºç©å®¶è³‡è¨Š
            document.getElementById('profileName').textContent = playerData.name;
            document.getElementById('profileLevel').textContent = playerData.level || 1;
            document.getElementById('profileExp').textContent = playerData.exp || 0;
            document.getElementById('profileCollected').textContent = collection.length;

            // è¨ˆç®—å†’éšªå¤©æ•¸
            const createdDate = new Date(playerData.createdAt);
            const today = new Date();
            const days = Math.floor((today - createdDate) / (1000 * 60 * 60 * 24));
            document.getElementById('profileDays').textContent = days;

            // è¨­å®šé ­åƒ
            const avatarIcon = avatarIcons[playerData.avatar] || 'fa-hiking';
            document.getElementById('profileAvatarIcon').className = 'fas ' + avatarIcon;

            // è¼‰å…¥æˆå°±
            loadAchievements(collection);

            // è¼‰å…¥æœ€è¿‘æ”¶é›†
            loadRecentCollections(collection);
        }

        // è¼‰å…¥æˆå°±
        function loadAchievements(collection) {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            achievements.forEach(achievement => {
                let unlocked = false;
                
                if (typeof achievement.requirement === 'number') {
                    unlocked = collection.length >= achievement.requirement;
                } else if (achievement.requirement === 'nature-complete') {
                    const natureSpots = ['é¯‰é­šæ½­', 'é›²å±±æ°´', 'æ…•è°·æ…•é­š'];
                    unlocked = natureSpots.every(spot => collection.some(c => c.name === spot));
                } else if (achievement.requirement === 'culture-complete') {
                    const cultureSpots = ['èŠ±è“®ç³–å» ', 'å£½è±è»Šç«™', 'æ±è¯å¤§å­¸'];
                    unlocked = cultureSpots.every(spot => collection.some(c => c.name === spot));
                } else if (achievement.requirement === 'special-complete') {
                    const specialSpots = ['ç«‹å·æ¼å ´', 'è±ç”°æ–‡å²é¤¨'];
                    unlocked = specialSpots.every(spot => collection.some(c => c.name === spot));
                }

                const badge = document.createElement('div');
                badge.style.cssText = `
                    text-align: center;
                    padding: 20px;
                    background: ${unlocked ? 'linear-gradient(135deg, #7cb342 0%, #aed581 100%)' : '#f5f5f5'};
                    border-radius: 12px;
                    color: ${unlocked ? 'white' : '#999'};
                `;
                badge.innerHTML = `
                    <i class="fas ${achievement.icon}" style="font-size: 32px; margin-bottom: 8px;"></i>
                    <div style="font-size: 12px; font-weight: 600;">${getAchievementName(achievement.i18nKey)}</div>
                `;
                achievementsList.appendChild(badge);
            });
        }

        // è¼‰å…¥æœ€è¿‘æ”¶é›†
        function loadRecentCollections(collection) {
            const recentList = document.getElementById('recentCollections');
            
            if (collection.length === 0) {
                recentList.innerHTML = `<p style="color: #999; text-align: center;" data-i18n="profile.noCollections">é‚„æ²’æœ‰æ”¶é›†ä»»ä½•æ™¯é»</p>`;
                i18n.translatePage(); // é‡æ–°ç¿»è­¯
                return;
            }

            const recent = collection.slice(-5).reverse();
            recentList.innerHTML = recent.map(item => {
                const date = new Date(item.collectedAt);
                const locale = currentLanguage === 'en' ? 'en-US' : currentLanguage === 'ja' ? 'ja-JP' : 'zh-TW';
                return `
                    <div style="padding: 12px 0; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">${item.name}</div>
                            <div style="font-size: 12px; color: #999;">
                                ${date.toLocaleDateString(locale)} ${date.toLocaleTimeString(locale, {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                        <i class="fas fa-check-circle" style="color: #7cb342; font-size: 20px;"></i>
                    </div>
                `;
            }).join('');
        }

        // é‡ç½®é€²åº¦
        function resetProgress() {
            const confirmMsg = i18n.t('profile.resetConfirm');
            const successMsg = i18n.t('profile.resetSuccess');
            
            if (confirm(confirmMsg)) {
                localStorage.removeItem('player');
                localStorage.removeItem('collection');
                alert(successMsg);
                window.location.href = 'index.html';
            }
        }

        // åˆå§‹åŒ–
        loadProfile();
    
        // èªè¨€åˆ‡æ›å™¨åŠŸèƒ½
        const languageBtn = document.getElementById('languageBtn');
        const languageDropdown = document.getElementById('languageDropdown');
        const currentFlag = document.getElementById('currentFlag');
        const languageOptions = document.querySelectorAll('.language-option');
        const languageFlags = {'zh-TW': 'ğŸ‡¹ğŸ‡¼', 'en': 'ğŸ‡ºğŸ‡¸', 'ja': 'ğŸ‡¯ğŸ‡µ'};
        
        if (languageBtn) {
            languageBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                languageDropdown.classList.toggle('show');
            });
            document.addEventListener('click', () => languageDropdown.classList.remove('show'));
        }
        
        languageOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = option.getAttribute('data-lang');
                i18n.setLanguage(lang);
                currentLanguage = lang;
                currentFlag.textContent = languageFlags[lang];
                languageOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                languageDropdown.classList.remove('show');
                
                // ğŸ¯ é‡æ–°è¼‰å…¥å€‹äººè³‡æ–™
                loadProfile();
            });
        });
        
        const currentLang = i18n.getCurrentLanguage();
        currentFlag.textContent = languageFlags[currentLang];
        languageOptions.forEach(option => {
            if (option.getAttribute('data-lang') === currentLang) option.classList.add('active');
        });
    </script>
</body>
</html>
