// âš ï¸ é‡è¦ï¼šè«‹å°‡ä¸‹é¢çš„ YOUR_GROQ_API_KEY æ›¿æ›æˆä½ çš„çœŸå¯¦ Groq API Key
const API_KEY = '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';
const API_URL = 'https://api.groq.com/openai/v1/chat/completions';

// å£½è±æ™¯é»è³‡æ–™åº«ï¼ˆ14å€‹æ™¯é»ï¼‰
const shoufengData = {
    spots: [
        // ç°¡å–®æ™¯é»
        {
            name: 'å£½è±ç«è»Šç«™',
            difficulty: 'ç°¡å–®',
            description: 'å£½è±è»Šç«™ä½æ–¼èŠ±è“®ç¸£å£½è±é„‰ï¼Œç‚ºè‡ºç£éµè·¯å…¬å¸è‡ºæ±ç·šçš„éµè·¯è»Šç«™ï¼Œæ ¹æ“š2024å¹´è³‡æ–™ï¼Œæœ¬ç«™æ¯æ—¥æ—…é‹é‡ç´„ç‚º697ï¼Œåœ¨å°éµå„ç«™ä¸­æ’è¡Œç¬¬155å',
            activities: 'æ‹ç…§æ‰“å¡ã€çœ‹ç«è»Šé€²ç«™',
            tips: 'å»ºè­°æ­ç«è»Šä¾†è¨ªæ›´æœ‰æ„Ÿè¦ºï¼Œæ—©ä¸Š11é»å‰å¯ä»¥å»é™„è¿‘çš„å£½è±æ—©é¤åƒæ—©é¤',
            route: 'æ–‡åŒ–é«”é©—'
        },
        {
            name: 'è±ç”°ç«è»Šç«™',
            difficulty: 'ç°¡å–®',
            description: 'è±ç”°è»Šç«™ä½æ–¼èŠ±è“®ç¸£å£½è±é„‰ï¼Œç‚ºè‡ºç£éµè·¯å…¬å¸è‡ºæ±ç·šçš„éµè·¯è»Šç«™ï¼Œç›®å‰è»Šç«™ç­‰ç´šç‚ºç°¡æ˜“ç«™ï¼Œæ ¹æ“š2024å¹´è³‡æ–™ï¼Œæœ¬ç«™æ¯æ—¥æ—…é‹é‡ç´„ç‚º86[2]ï¼Œåœ¨å°éµå„ç«™ä¸­æ’è¡Œç¬¬209å',
            activities: 'è»Šç«™æ‹ç…§ã€å‘¨é‚Šæ•£æ­¥',
            tips: 'ä¸€å‡ºç«™å°±åˆ°äº”å‘³å±‹ï¼Œè±ç”°æ™¯é»å½¼æ­¤éƒ½å¾ˆè¿‘ï¼Œèµ°è·¯å¯ä»¥',
            route: 'æ–‡åŒ–é«”é©—'
        },
        {
            name: 'è€ƒå¤åšç‰©é¤¨',
            difficulty: 'ç°¡å–®',
            description: 'ä½æ–¼è‡ºç£èŠ±è“®ç¸£å£½è±é„‰è±å±±æ‘ï¼Œç‚ºèŠ±è“®ç¸£ç´šè€ƒå¤åšç‰©é¤¨ï¼Œå‰èº«ç‚ºè±ç”°å¸‚å ´ç¿»æ–°æ•´å»ºï¼Œé¤¨å…§å±•å‡ºå²å‰ç‰æ–‡åŒ–çš„åŸæ–™å€è±ç”°ç‰ç¤¦å€ï¼Œä¸¦é„°è¿‘æ”¯äºå¹²éºå€ã€é‡å…‰éºå€ç­‰å²å‰å¤§å‹ç‰ä½œåŠéºå€ï¼Œæ–¼2021å¹´1æœˆ24æ—¥é–‹é¤¨ï¼Œé¤¨è—åŠå±•å“ä»¥èŠ±è“®åœ°å€çš„è€ƒå¤éºå€æ–‡ç‰©ç‚ºæ”¶è—åŸºç¤ï¼Œä¸¦ä»¥èŠ±æ±åœ°å€è·ä»Š3500å¹´å‰ç¨ç‰¹ç‰æ–‡åŒ–ç”¢æ¥­ç‚ºå±•è¦½æ ¸å¿ƒï¼Œæˆªè‡³2021å¹´ç‚ºæ­¢ï¼Œè©²é¤¨é¤¨è—è¨ˆç´„80è¬ä»¶',
            activities: 'åƒè§€é«”é©—åŸä½æ°‘æ–‡åŒ–å’Œè€ƒå¤æ–‡åŒ–',
            tips: 'å±•é¤¨ç‚ºæ”¶è²»é€²å ´åƒè§€ï¼Œå…¨ç¥¨50å…ƒã€å„ªå¾…ç¥¨25å…ƒã€åœ˜é«”ç¥¨30å…ƒï¼Œé–‹æ”¾æ™‚é–“ç‚ºé€±ä¸‰è‡³é€±æ—¥ä¸Šåˆ09:30-ä¸‹åˆ5:00æ­¢ï¼ˆé–‰é¤¨å‰30åˆ†é˜åœæ­¢å…¥é¤¨ï¼‰ï¼Œæ¯é€±ä¸€è‡³é€±äºŒå›ºå®šä¼‘é¤¨ï¼Œåœ‹å®šå‡æ—¥å¦è¡Œå…¬å‘Š',
            route: 'æ–‡åŒ–é«”é©—'
        },
        {
            name: 'äº”å‘³å±‹',
            difficulty: 'ç°¡å–®',
            description: 'å­©å­å€‘ç¶“ç‡Ÿçš„å…¬ç›ŠäºŒæ‰‹å•†åº—ï¼Œå……æ»¿æ•™è‚²æ„ç¾©',
            activities: 'äºŒæ‰‹å•†å“å°‹å¯¶ã€æ”¯æŒåœ¨åœ°æ•™è‚²ã€èˆ‡å­©å­äº’å‹•',
            tips: 'æ¯é€±å…­æ—¥9:00-16:00ã€‚æš‘å‡(7/3~8/31)é–‹åº—æ™‚é–“ç‚ºæ¯é€±å››ã€äº”ã€å…­ã€æ—¥ã€ä¸€ ï¼Œé€±é–“ç‡Ÿæ¥­æ™‚é–“ç‚º10ï¼š00-16ï¼š00ï¼Œé€±æœ«ç‡Ÿæ¥­æ™‚é–“ç‚º 9:00-16:00ï¼å¯ä»¥æè´ˆäºŒæ‰‹ç‰©å“ï¼Œè¨˜å¾—å¸¶ç¾é‡‘ï¼Œä¸å¯ä»¥æ‹ç…§ç…§åˆ°å°æœ‹å‹',
            route: 'æ–‡åŒ–é«”é©—'
        },
        {
            name: 'è±ç”°é£Ÿè™Ÿ',
            difficulty: 'ç°¡å–®',
            description: 'è±ç”°å°é®ä¸Šå’Œç”Ÿæ´»æœ‰é—œçš„è¤‡åˆå¼å…±äº«ç©ºé–“ï¼›ä¹Ÿæ˜¯ã€Œä¸‰å­£ç”œé»ã€è±ç”°é£Ÿè™Ÿå’Œæ—…è²“ã€ï¼Œé›†ä¸€åˆ‡æ—¥å¸¸ç¾å¥½ä¸€èµ·å¥½å¥½åƒé£¯ã€ä¸æ€¥ä¸ç·©éè‘—åœ¨åœ°çš„å°æ—¥å­',
            activities: 'ç”œé»ã€å’–å•¡ã€è¼•é£Ÿã€åˆé¤ã€å…¸è—ç”Ÿæ´»é¸ç‰©',
            tips: 'é€±å…­ã€æ—¥ 11:30-17:00',
            route: 'ç‰¹è‰²é«”é©—'
        },
        
        // æ™®é€šæ™¯é»
        {
            name: 'ç«‹å·æ¼å ´',
            difficulty: 'æ™®é€š',
            description: 'ä½åœ¨å£½è±çš„ç«‹å·æ¼å ´ï¼Œåˆ©ç”¨å¤©ç„¶æ¹§æ³‰é¤Šæ®–é«”å‹é£½æ»¿ã€å‘³é“é®®ç¾çš„é»ƒé‡‘èœ†ï¼Œä¸¦è¨­ç«‹äº†æ–‡åŒ–ç”Ÿæ…‹é¤¨ã€èœ†ä¹‹é¤¨ã€é«”é©—æ± ã€é¤å»³ç­‰ï¼Œä¸åƒ…èƒ½å¤ è®“äººèªè­˜é»ƒé‡‘èœ†çš„ä¸€ç”Ÿã€é¤Šæ®–çš„éç¨‹ä¹‹å¤–ï¼Œé‚„èƒ½è¦ªè‡ªä¸‹æ°´é«”é©—ã€Œæ‘¸èœŠä»”å…¼æ´—è¤²ã€çš„æ¨‚è¶£ï¼Œé¤µé£Ÿé¤Šæ®–çš„é­šç¾¤ï¼Œæ˜¯ä¸€å€‹éå¸¸å—æ­¡è¿çš„è¦ªå­åŒæ¨‚çš„æ™¯é»',
            activities: 'æ‘¸èœ†é«”é©—ã€å“åšèœ†æ–™ç†ã€ç”Ÿæ…‹æ•™è‚²',
            food: 'é»ƒé‡‘èœ†ã€èœ†ç²¾ã€èœ†ä¸¸ã€ç‚’èœ†',
            tips: 'è¨˜å¾—å¸¶æ›æ´—è¡£ç‰©ï¼å…è²»åƒè§€ã€æ‘¸èœ†é«”é©—æ¯200å…ƒï¼Œ5æ­²ä»¥ä¸‹ä¸æ”¶è²»ï¼Œåƒ…éœ€ä»˜é™ªåŒå¤§äººçš„è²»ç”¨ã€èœ†æ®¼DIYæ¯äºº200å…ƒï¼Œéœ€æ–¼3å¤©äº‹å…ˆé ç´„',
            route: 'ç‰¹è‰²é«”é©—'
        },
        {
            name: 'ç¢§è“®å¯ºï¼ˆè±ç”°ç¥ç¤¾ï¼‰',
            difficulty: 'æ™®é€š',
            description: 'ç¢§è“®å¯ºçš„å‰èº«æ˜¯ã€Œè±ç”°ç¥ç¤¾ã€ï¼Œç‚ºç™¾å¹´èˆˆå»ºçš„å¤å¯ºï¼Œé›–ç„¶åŸæœ‰ç¥ç¤¾å»ºç¯‰å·²æ¶ˆå¤±ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€æ£Ÿä¸­åœ‹å¼çš„å»Ÿå®‡ï¼Œç„¶è€Œã€Œé³¥å±…ã€ã€ã€Œåƒæ‹œé“ã€ã€ã€ŒçŸ³ç‡ˆã€ï¼Œä»¥åŠå¤§æ®¿é–€å‰çš„ã€Œç‹›çŠ¬ã€ç­‰éºè·¡ï¼Œæ­£å¨“å¨“è¿°èªªè‘—æ–°èˆŠæ–‡åŒ–çš„ç›¸æ¿¡æ»‹é•·ï¼Œåœ¨ä»Šè±è£¡æ‘ä¸­å±±è·¯ã€æ°‘æ¬Šè¡—å£æœ‰åº§é«˜ç´„10å…¬å°ºï¼Œå¯¬6å…¬å°ºï¼Œå¯«æœ‰ã€Œç¢§è“®å¯ºã€çš„é³¥å±…ï¼Œé€™æ˜¯æ˜”æ—¥ã€Œè±ç”°ç¥ç¤¾ã€ä¸‰åº§é³¥å±…ä¸­åƒ…å­˜çš„ä¸€åº§ï¼Œå¾é€™åº§é³¥å±…æ²¿è‘—é•·ç´„ä¸€å…¬é‡Œçš„åƒæ‹œé“èµ°è‡³æ°‘æ¬Šè¡—åº•ï¼Œå³æ˜¯ã€Œç¢§è“®å¯ºã€',
            activities: 'åƒæ‹œã€æ¬£è³æ—¥å°æ··åˆå»ºç¯‰',
            tips: 'éœ€è¦çˆ¬éšæ¢¯ï¼Œä¸‹åˆå…‰ç·šæœ€ç¾ï¼Œä¿æŒå®‰éœå°Šé‡å®—æ•™å ´æ‰€',
            route: 'æ–‡åŒ–é«”é©—'
        },
        {
            name: 'é›²å±±æ°´',
            difficulty: 'æ™®é€š',
            description: 'é›²å±±æ°´æ¤ç‰©è¾²å ´è¢«è­½ç‚ºèŠ±è“®ç¥•å¢ƒæ™¯é»ï¼Œèµ°å…¥é›²å±±æ°´å°±åƒæ˜¯ä¸€ç§’æŠµé”æ­æ´²é„‰æ‘ï¼Œå¤§ç‰‡ç¿ ç¶ çš„è‰çš®ã€æ°´å¤©ä¸€è‰²çš„å¤¢å¹»æ¹–ã€èŒ‚å¯†çš„è½ç¾½æ¾æ£®æ—å’Œå‚¾å€’ç‰›å¥¶èˆ¬çš„è·³çŸ³ç€‘å¸ƒï¼Œå¦‚ç½®èº«æ–¼å¤¢å¢ƒå¤©å ‚èˆ¬çš„è‡ªç„¶æ™¯è‰²ï¼Œè®“äººä¸€çœ¼æœ›å»ä¾¿èƒ½æƒé™¤å¿ƒä¸­çš„æ‰€æœ‰ç…©æƒ±ã€‚ç”±æ–¼é›²å±±æ°´ç¨®æ¤äº†å¤šç¨®ä¸åŒçš„èŠ±è‰æ¨¹æœ¨ï¼Œå› æ­¤é›²å±±æ°´çš„æ™¯è‰²ä¹Ÿæœƒéš¨è‘—å››å­£è®ŠåŒ–è€Œæœ‰ä¸åŒçš„ç¾ï¼Œå°¤å…¶ç§‹å†¬ä¹‹éš›æ˜¯è³è½ç¾½æ¾è½‰é‡‘é»ƒå’Œç´…æ£•è‰²çš„æœ€ä½³æ™‚ç¯€',
            activities: 'åƒè§€ã€æ•£æ­¥ã€æ‹ç…§ã€é¨è…³è¸è»Š',
            tips: 'é–€å£ç§Ÿå€Ÿè…³è¸è»Šæˆ–é›»å‹•è»Šé™„è´ˆé–€ç¥¨',
            route: 'è‡ªç„¶ç”Ÿæ…‹'
        },
        {
            name: 'ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹',
            difficulty: 'æ™®é€š',
            description: 'æ˜Ÿå·´å…‹èŠ±è“®ç†æƒ³é–€å¸‚åƒå¾ç«¥è©±æ•…äº‹è£¡èµ°å‡ºä¾†çš„å¤¢å¹»å°å±‹ï¼Œéš¨è‘—å­£ç¯€è®ŠåŒ–ï¼Œæœ‰è½ç¾½æ¾ç›¸ä¼´ï¼Œæ¹–é¢å€’å½±éš¨è‘—ä¸€æ—¥çš„å…‰ç·šè®ŠåŒ–ï¼Œå¦‚åŒé¢¨æ™¯ç•«ä¸€èˆ¬ï¼Œè®“äººæœ‰ç¨®ç½®èº«ä¸æ˜¯ç¾å¯¦ä¸–ç•Œçš„æ„Ÿè¦º',
            activities: 'åƒè§€ã€ç¨ä½œä¼‘æ¯ã€äº«ç”¨æ˜Ÿå·´å…‹é£²å“å’Œé£Ÿç‰©',
            tips: 'å…è²»åƒè§€ï¼æœ‰å°ˆç”¨åœè»Šå ´',
            route: 'è‡ªç„¶ç”Ÿæ…‹'
        },
        
        // å›°é›£æ™¯é»
        {
            name: 'æ¨¹æ¹–æ­¥é“',
            difficulty: 'å›°é›£',
            description: 'ä½åœ¨å£½è±é„‰çš„æ¨¹æ¹–æ‘çš„ã€Œæ¨¹æ¹–ç€‘å¸ƒã€ï¼Œåº§è½åœ¨éš±å¯†çš„å±±æ—ä¹‹ä¸­ï¼Œå› åœ¨æ¨¹æ¹–æ‘è–å±±ï¼Œæ‰€ä»¥ç•¶åœ°å±…æ°‘å¤šç¨±ç‚ºã€Œè–å±±ç€‘å¸ƒã€ï¼Œå¾è‡º9ç·šç¶“è±é„‰è±ç”°225.5å…¬é‡Œè™•å¯è¦‹æ¨¹æ¹–ç¤¾å€çš„é•·å½¢æ°´æ³¥æŒ‡æ¨™ï¼Œå³è½‰é€²å…¥ç¤¾å€å¾€æ¨¹æ¹–æ©‹ï¼ˆè–å±±æ©‹ï¼‰çš„æ–¹å‘èµ°ï¼Œæ²¿é€”æœƒçœ‹è¦‹é“è·¯æ—ç¨®æ¤çš„æ«»èŠ±æ¨¹ï¼Œæ¯åˆ°èŠ±å­£ï¼Œå±±é ­æ•¸ç™¾æ£µå«£ç´…çš„æ«»èŠ±é½ŠåŠ›ç¶»æ”¾ï¼Œæ˜ è¥¯åœ¨è’¼é¬±çš„ç¶ è‰²å±±æ—ï¼Œæ›´é¡¯ç¾å‡ºæ«»èŠ±çš„çµ¢éº—',
            activities: 'æ¼«æ­¥çˆ¬å±±ã€è³æ«»ã€æ‹ç…§',
            tips: 'å»ºè­°é¨è»Šåˆ°å±±ä¸‹å†çˆ¬ä¸Šå»',
            route: 'è‡ªç„¶ç”Ÿæ…‹'
        },
        {
            name: 'è±ç››æ›¸åº—',
            difficulty: 'å›°é›£',
            description: 'è±ç››æ›¸åº—ï¼Œ2024å¹´12æœˆ1æ—¥å°å¤–ç‡Ÿæ¥­çš„èŠ±è“®ç¨ç«‹æ›¸åº—ï¼Œä½æ–¼å°ä¹ä¸™ç·šï¼Œé¯‰é­šæ½­å°¾çš„è–æºªæ—é˜¿ç¾æ—Rinaheméƒ¨è½',
            activities: 'é–±è®€ã€è³¼è²·æ›¸ç±ã€äº«ç”¨é£²å“',
            tips: 'é™„è¿‘æ²’æœ‰å°ˆå±¬åœè»Šå ´',
            route: 'ç‰¹è‰²é«”é©—'
        },
        {
            name: 'ç™½é®‘æºª',
            difficulty: 'å›°é›£',
            description: 'æ¸…æ¾ˆæºªæµç§˜å¢ƒï¼Œä¿æŒåŸå§‹è‡ªç„¶é¢¨è²Œ',
            activities: 'æºªæµæˆ²æ°´ã€æº¯æºªã€ç”Ÿæ…‹è§€å¯Ÿ',
            tips: 'ç©æ°´è¨˜å¾—å¸¶æ³³è¡£ï¼Œé›¨å¤©æˆ–é¢±é¢¨å¾Œä¸è¦å»',
            route: 'è‡ªç„¶ç”Ÿæ…‹'
        },
        {
            name: 'é¯‰é­šæ½­',
            difficulty: 'å›°é›£',
            description: 'èŠ±è“®æœ€å¤§çš„å…§é™¸æ¹–æ³Šï¼Œé¢ç©104å…¬é ƒ',
            activities: 'ç’°æ½­é¨è»Šã€åˆ’èˆ¹ã€è³è¢ï¼ˆ4-5æœˆï¼‰ã€æ¹–ç•”å’–å•¡',
            food: 'æ´»é­šæ–™ç†ã€æ¹–ç•”é¤å»³',
            tips: 'å»ºè­°ç§Ÿè…³è¸è»Šç’°æ¹–ç´„1å°æ™‚ï¼Œ4-5æœˆè¢ç«èŸ²å­£å¿…è¨ª',
            route: 'è‡ªç„¶ç”Ÿæ…‹'
        },
        {
            name: 'è±æ˜¥å†°è“å®¤',
            difficulty: 'å›°é›£',
            description: 'åªæœ‰è³£ç”˜è”—å†°ï¼Œé…æ–™åŒ…å«ã€Œç´…è±†ã€ç¶ è±†ã€èŠ±è±†ã€èŠ‹é ­ã€é³³æ¢¨ã€ä»™è‰ã€ï¼Œé¸2ç¨®é…æ–™åƒ¹æ ¼ç‚º60å…ƒ',
            activities: 'å¤å­£é™å®šäº«ç”¨å†°å“',
            tips: 'å¤å­£é™å®š',
            route: 'ç‰¹è‰²é«”é©—'
        }
    ],
    
    routes: {
        halfDay: 'åŠæ—¥éŠå»ºè­°ï¼šè±ç”°ç«è»Šç«™ï¼ˆ30åˆ†é˜ï¼‰â†’ è€ƒå¤åšç‰©é¤¨ï¼ˆ1.5å°æ™‚ï¼‰â†’ è±ç”°é£Ÿè™Ÿï¼ˆ1å°æ™‚ï¼‰',
        fullDay: 'ä¸€æ—¥éŠå»ºè­°ï¼šæ¨¹æ¹–æ­¥é“ï¼ˆ2å°æ™‚ï¼‰â†’ åˆé¤ â†’ ç«‹å·æ¼å ´ï¼ˆ1.5å°æ™‚ï¼‰â†’ ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹ï¼ˆ1å°æ™‚ï¼‰â†’ äº”å‘³å±‹ï¼ˆ1å°æ™‚ï¼‰â†’ è€ƒå¤åšç‰©é¤¨ï¼ˆ1.5å°æ™‚ï¼‰',
        culture: 'æ–‡åŒ–è·¯ç·šï¼šè±ç”°ç«è»Šç«™ â†’ äº”å‘³å±‹ â†’ è€ƒå¤åšç‰©é¤¨â†’ ç¢§è“®å¯º',
        nature: 'è‡ªç„¶è·¯ç·šï¼šå£½è±ç«è»Šç«™ â†’ é›²å±±æ°´ â†’ ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹â†’ç™½é®‘æºª â†’ é¯‰é­šæ½­ â†’ æ¨¹æ¹–æ­¥é“',
        special: 'ç‰¹è‰²è·¯ç·šï¼šè±ç”°ç«è»Šç«™ â†’ è±ç”°é£Ÿè™Ÿ â†’ è±æ˜¥å†°è“å®¤ â†’ è±ç››æ›¸åº— â†’ ç«‹å·æ¼å ´',
        photo: 'æœ€é©åˆæ‹ç…§ï¼šé¯‰é­šæ½­ï¼ˆæ¹–æ™¯ï¼‰ã€é›²å±±æ°´ï¼ˆè½ç¾½æ¾ï¼‰ã€å£½è±ç«è»Šç«™ï¼ˆå¾©å¤é¢¨ï¼‰ã€ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹(ç«¥è©±å°å±‹) ã€ç¢§è“®å¯ºï¼ˆç¥ç¤¾éºè·¡ï¼‰',
        food: 'ç¾é£Ÿæ¨è–¦ï¼šè±æ˜¥å†°è“åº—ï¼ˆç”˜è”—å†°ï¼‰ã€ç«‹å·æ¼å ´ï¼ˆé»ƒé‡‘èœ†æ–™ç†ï¼‰ã€é¯‰é­šæ½­å‘¨é‚Šï¼ˆæ´»é­šæ–™ç†ï¼‰ã€è±ç”°é£Ÿè™Ÿ(ç”œé»ã€å’–å•¡ã€è¼•é£Ÿã€åˆé¤) '
    },
    
    statistics: {
        total: 14,
        easy: 5,
        normal: 4,
        hard: 5
    }
};

// å»ºç«‹ç³»çµ±æç¤ºè©
function createSystemPrompt() {
    return `ä½ æ˜¯ã€Œå£½è±å°‹å¯¶å·´ã€çš„å°ˆå±¬ AI æ—…éŠåŠ©æ‰‹ï¼Œè² è²¬å”åŠ©éŠå®¢è¦åŠƒèŠ±è“®å£½è±é„‰çš„æ—…éŠè¡Œç¨‹ã€‚

ã€ä½ çš„è§’è‰²ã€‘
- è¦ªåˆ‡ã€ç†±æƒ…çš„åœ¨åœ°åš®å°
- ç”¨è¼•é¬†ã€æ´»æ½‘çš„èªæ°£å°è©±
- é©æ™‚ä½¿ç”¨ emoji è®“å°è©±æ›´ç”Ÿå‹•ï¼ˆä½†ä¸è¦éåº¦ä½¿ç”¨ï¼‰

ã€å£½è±æ™¯é»è³‡è¨Šã€‘
å£½è±é„‰å…±æœ‰ 14 å€‹ç²¾é¸æ™¯é»ï¼Œåˆ†ç‚ºä¸‰å¤§è·¯ç·šï¼š
1. è‡ªç„¶ç”Ÿæ…‹è·¯ç·šï¼ˆ5å€‹æ™¯é»ï¼‰ï¼šæ¨¹æ¹–æ­¥é“ã€ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹ã€ç™½é®‘æºªã€é¯‰é­šæ½­ã€é›²å±±æ°´
2. æ–‡åŒ–é«”é©—è·¯ç·šï¼ˆ5å€‹æ™¯é»ï¼‰ï¼šå£½è±ç«è»Šç«™ã€è±ç”°ç«è»Šç«™ã€ç¢§è“®å¯ºã€è€ƒå¤åšç‰©é¤¨ã€äº”å‘³å±‹
3. ç‰¹è‰²é«”é©—è·¯ç·šï¼ˆ4å€‹æ™¯é»ï¼‰ï¼šè±æ˜¥å†°è“åº—ã€è±ç››æ›¸åº— ã€ç«‹å·æ¼å ´ã€è±ç”°é£Ÿè™Ÿ

æ™¯é»é›£åº¦åˆ†é¡ï¼š
- ç°¡å–®æ™¯é»ï¼ˆ5å€‹ï¼‰ï¼šå£½è±ç«è»Šç«™ã€è±ç”°ç«è»Šç«™ã€è€ƒå¤åšç‰©é¤¨ã€äº”å‘³å±‹ã€è±ç”°é£Ÿè™Ÿ
- æ™®é€šæ™¯é»ï¼ˆ4å€‹ï¼‰ï¼šç«‹å·æ¼å ´ã€ç¢§è“®å¯ºã€ç†æƒ³å¤§åœ°æ˜Ÿå·´å…‹ã€é›²å±±æ°´
- å›°é›£æ™¯é»ï¼ˆ5å€‹ï¼‰ï¼šæ¨¹æ¹–æ­¥é“ã€è±ç››æ›¸åº—ã€ç™½é®‘æºªã€é¯‰é­šæ½­ã€è±æ˜¥å†°è“å®¤ 

è©³ç´°æ™¯é»è³‡è¨Šï¼š
${JSON.stringify(shoufengData.spots, null, 2)}

æ¨è–¦è·¯ç·šï¼š
${JSON.stringify(shoufengData.routes, null, 2)}

ã€å›ç­”åŸå‰‡ã€‘
1. ç°¡æ½”æ˜ç­ï¼šå›ç­”æ§åˆ¶åœ¨ 100-200 å­—å…§
2. å…·é«”å¯¦ç”¨ï¼šçµ¦å‡ºæ˜ç¢ºçš„å»ºè­°å’Œè³‡è¨Š
3. åœ¨åœ°ç‰¹è‰²ï¼šçªå‡ºå£½è±çš„ç¨ç‰¹é­…åŠ›
4. å‹å–„äº’å‹•ï¼šé¼“å‹µéŠå®¢æå•å’Œæ¢ç´¢
5. è·¯ç·šè¦åŠƒï¼šæ ¹æ“šæ™‚é–“ï¼ˆåŠæ—¥/ä¸€æ—¥ï¼‰ã€èˆˆè¶£ï¼ˆè‡ªç„¶/æ–‡åŒ–/ç‰¹è‰²ï¼‰æ¨è–¦æ™¯é»

ã€å›ç­”æ ¼å¼ã€‘
- æ¨è–¦æ™¯é»æ™‚ï¼šèªªæ˜ç‰¹è‰² + ç‚ºä»€éº¼æ¨è–¦ + å¯¦ç”¨å»ºè­°
- è·¯ç·šè¦åŠƒï¼šçµ¦å‡ºå…·é«”é †åºå’Œæ™‚é–“å»ºè­°
- ç¾é£Ÿæ¨è–¦ï¼šçµåˆæ™¯é»ä¸€èµ·ä»‹ç´¹
- é›£åº¦æé†’ï¼šå›°é›£æ™¯é»è¦æé†’äº¤é€šæˆ–é«”åŠ›éœ€æ±‚

ç¾åœ¨è«‹ç”¨é€™å€‹è§’è‰²ä¾†å›ç­”éŠå®¢çš„å•é¡Œï¼`;
}

// ç™¼é€è¨Šæ¯å‡½æ•¸
async function sendMessage() {
    const input = document.getElementById('userInput');
    const messagesDiv = document.getElementById('chatMessages');
    const sendBtn = document.getElementById('sendBtn');
    const userMessage = input.value.trim();
    
    if (!userMessage) return;
    
    // æª¢æŸ¥ API Key
    if (API_KEY === 'YOUR_GROQ_API_KEY' || API_KEY === 'å¡«å…¥ä½ çš„GROQçš„å¯†é‘°') {
        alert('âš ï¸ è«‹å…ˆè¨­å®šä½ çš„ Groq API Keyï¼\n\nè«‹ç·¨è¼¯ chat.js æª”æ¡ˆï¼Œå°‡ã€Œå¡«å…¥ä½ çš„GROQçš„å¯†é‘°ã€æ›¿æ›æˆä½ çš„çœŸå¯¦ API Keyã€‚');
        return;
    }

    // éš±è—å¿«é€Ÿå•é¡ŒæŒ‰éˆ•
    const quickQuestions = document.getElementById('quickQuestions');
    if (quickQuestions) {
        quickQuestions.style.display = 'none';
    }

    // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
    addUserMessage(userMessage);
    input.value = '';
    sendBtn.disabled = true;

    // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
    const typingId = showTypingIndicator();

    try {
        // å‘¼å« Groq API
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${API_KEY}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: 'llama-3.3-70b-versatile', // Groq æœ€å¥½çš„å…è²»æ¨¡å‹
                messages: [
                    {
                        role: 'system',
                        content: createSystemPrompt()
                    },
                    {
                        role: 'user',
                        content: userMessage
                    }
                ],
                temperature: 0.7,
                max_tokens: 500
            })
        });

        // ç§»é™¤è¼‰å…¥å‹•ç•«
        removeTypingIndicator(typingId);

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            console.error('API éŒ¯èª¤è©³æƒ…:', errorData);
            throw new Error(`API éŒ¯èª¤ï¼š${response.status}`);
        }

        const data = await response.json();
        console.log('API å›æ‡‰:', data);
        
        // é¡¯ç¤º AI å›æ‡‰
        if (data.choices && data.choices[0] && data.choices[0].message) {
            const aiResponse = data.choices[0].message.content;
            addAIMessage(aiResponse);
        } else {
            addAIMessage('æŠ±æ­‰ï¼Œæˆ‘ç¾åœ¨ç„¡æ³•å›ç­”ï¼Œè«‹ç¨å¾Œå†è©¦ ğŸ˜…');
        }

    } catch (error) {
        console.error('éŒ¯èª¤:', error);
        removeTypingIndicator(typingId);
        
        let errorMessage = 'å“å‘€ï¼ç™¼ç”ŸéŒ¯èª¤äº† ğŸ˜¢\n\n';
        if (error.message.includes('API éŒ¯èª¤: 400')) {
            errorMessage += 'è«‹æ±‚æ ¼å¼éŒ¯èª¤ã€‚è«‹æª¢æŸ¥ API è¨­å®šã€‚';
        } else if (error.message.includes('API éŒ¯èª¤: 401')) {
            errorMessage += 'API Key ç„¡æ•ˆæˆ–å·²éæœŸã€‚\nè«‹é‡æ–°ç”³è«‹ Groq API Keyã€‚';
        } else if (error.message.includes('API éŒ¯èª¤: 429')) {
            errorMessage += 'è«‹æ±‚å¤ªé »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
        } else if (error.message.includes('Failed to fetch')) {
            errorMessage += 'ç¶²è·¯é€£ç·šæœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®šã€‚';
        } else {
            errorMessage += `éŒ¯èª¤è¨Šæ¯ï¼š${error.message}`;
        }
        
        addAIMessage(errorMessage);
    }

    sendBtn.disabled = false;
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
function addUserMessage(message) {
    const messagesDiv = document.getElementById('chatMessages');
    const time = getCurrentTime();
    
    const messageHTML = `
        <div class="message-group user-group">
            <div class="messages">
                <div class="message user-message">
                    <div class="message-content">${escapeHtml(message)}</div>
                    <span class="message-time">${time}</span>
                </div>
            </div>
        </div>
    `;
    
    messagesDiv.insertAdjacentHTML('beforeend', messageHTML);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// é¡¯ç¤º AI è¨Šæ¯
function addAIMessage(message) {
    const messagesDiv = document.getElementById('chatMessages');
    const time = getCurrentTime();
    
    // å°‡æ›è¡Œç¬¦è™Ÿè½‰æ›ç‚º <br>
    const formattedMessage = message.replace(/\n/g, '<br>');
    
    const messageHTML = `
        <div class="message-group ai-group">
            <div class="avatar-small">
                <i class="fas fa-robot"></i>
            </div>
            <div class="messages">
                <div class="message ai-message">
                    <div class="message-content">${formattedMessage}</div>
                    <span class="message-time">${time}</span>
                </div>
            </div>
        </div>
    `;
    
    messagesDiv.insertAdjacentHTML('beforeend', messageHTML);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// é¡¯ç¤ºè¼‰å…¥å‹•ç•«
function showTypingIndicator() {
    const messagesDiv = document.getElementById('chatMessages');
    const id = 'typing-' + Date.now();
    
    const typingHTML = `
        <div class="message-group ai-group" id="${id}">
            <div class="avatar-small">
                <i class="fas fa-robot"></i>
            </div>
            <div class="messages">
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>
    `;
    
    messagesDiv.insertAdjacentHTML('beforeend', typingHTML);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    return id;
}

// ç§»é™¤è¼‰å…¥å‹•ç•«
function removeTypingIndicator(id) {
    const element = document.getElementById(id);
    if (element) {
        element.remove();
    }
}

// å¿«é€Ÿå•é¡ŒåŠŸèƒ½
function askQuickQuestion(question) {
    const input = document.getElementById('userInput');
    input.value = question;
    sendMessage();
}

// ç²å–ç•¶å‰æ™‚é–“
function getCurrentTime() {
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    return `${hours}:${minutes}`;
}

// HTML è·³è„«å‡½æ•¸ï¼ˆé˜²æ­¢ XSS æ”»æ“Šï¼‰
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Enter éµç™¼é€è¨Šæ¯
document.getElementById('userInput')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

// é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('å£½è±å°‹å¯¶å·´ AI åŠ©æ‰‹å·²æº–å‚™å°±ç·’ï¼');
    console.log('ä½¿ç”¨ Groq API (llama-3.3-70b-versatile)');
    console.log('æ™¯é»è³‡æ–™åº«å·²è¼‰å…¥ï¼š14å€‹æ™¯é»');
    
    // è‡ªå‹•èšç„¦è¼¸å…¥æ¡†
    const input = document.getElementById('userInput');
    if (input) {
        input.focus();
    }
});
