<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™¯é»åœ°åœ– | å£½è±å°‹å¯¶å·´å£«</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* é–ƒçˆå‹•ç•« */
        @keyframes shimmer {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        .special-spot {
            animation: shimmer 2s ease-in-out infinite;
        }

        .special-spot .spot-list-image {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%) !important;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .locked-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body class="game-home">
    <!-- å°èˆªåˆ— -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <div class="nav-brand-icon">
                    <i class="fas fa-map"></i>
                </div>
                <span id="pageTitle">æ™¯é»åœ°åœ–</span>
            </div>
            <div class="nav-actions">
                <button class="nav-icon-btn" onclick="filterSpots('all')" title="å…¨éƒ¨æ™¯é»">
                    <i class="fas fa-list"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ç¯©é¸æ¨™ç±¤ -->
    <div style="background: white; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div class="container">
            <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px;">
                <button class="filter-tag active" data-filter="all" onclick="filterSpots('all')">
                    <i class="fas fa-globe"></i> å…¨éƒ¨
                </button>
                <button class="filter-tag" data-filter="nature" onclick="filterSpots('nature')">
                    <i class="fas fa-leaf"></i> è‡ªç„¶æ¢ç´¢
                </button>
                <button class="filter-tag" data-filter="culture" onclick="filterSpots('culture')">
                    <i class="fas fa-torii-gate"></i> è±ç”°æ–‡åŒ–
                </button>
                <button class="filter-tag" data-filter="special" onclick="filterSpots('special')">
                    <i class="fas fa-star"></i> éš±è—å¯¶è—
                </button>
            </div>
        </div>
    </div>

    <!-- æ™¯é»åˆ—è¡¨ -->
    <section style="padding: 20px 16px 100px;">
        <div class="container">
            <div id="spotsList" class="spots-list-grid">
                <!-- æ™¯é»å¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
            </div>
        </div>
    </section>

    <!-- åº•éƒ¨å°èˆª -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <a href="game-home.html" class="nav-item">
                <div class="nav-item-icon">
                    <i class="fas fa-home"></i>
                </div>
                <span class="nav-item-label">ä¸»é </span>
            </a>
            <a href="map.html" class="nav-item active">
                <div class="nav-item-icon">
                    <i class="fas fa-map"></i>
                </div>
                <span class="nav-item-label">åœ°åœ–</span>
            </a>
            <a href="collection.html" class="nav-item">
                <div class="nav-item-icon">
                    <i class="fas fa-book"></i>
                </div>
                <span class="nav-item-label">æ”¶è—</span>
            </a>
            <a href="profile.html" class="nav-item">
                <div class="nav-item-icon">
                    <i class="fas fa-user"></i>
                </div>
                <span class="nav-item-label">å€‹äºº</span>
            </a>
        </div>
    </nav>

    <script src="spots-data.js"></script>
    <script>
        // è¼‰å…¥æ”¶è—è¨˜éŒ„
        const collection = JSON.parse(localStorage.getItem('collection')) || [];
        let currentFilter = 'all';

        // å¾ URL è®€å–è·¯ç·šåƒæ•¸
        function getRouteFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('route') || 'all';
        }

        // æª¢æŸ¥éš±è—æ¬¾æ˜¯å¦å·²è§£é–
        function isSpecialUnlocked(spot) {
            if (!spot.isSpecial) return true; // ä¸æ˜¯éš±è—æ¬¾ï¼Œç›´æ¥è¿”å›å·²è§£é–
            
            // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆè§£é–æ¢ä»¶ï¼ˆæ‰“å¡äº†å°æ‡‰çš„ä¸€èˆ¬æ™¯é»ï¼‰
            return collection.some(c => c.id === spot.unlockRequire);
        }

        // ç”Ÿæˆæ™¯é»åˆ—è¡¨
        function renderSpots(filter = 'all') {
            const spotsList = document.getElementById('spotsList');
            
            // æ ¹æ“šè·¯ç·šéæ¿¾æ™¯é»
            let filteredSpots = [];
            
            if (filter === 'all') {
                // é¡¯ç¤ºæ‰€æœ‰æ™¯é»ï¼ˆåŒ…å«éš±è—æ¬¾ï¼‰
                filteredSpots = spotsData;
            } else if (routesConfig[filter]) {
                // é¡¯ç¤ºç‰¹å®šè·¯ç·šçš„æ™¯é»
                const routeSpots = routesConfig[filter].spots || [];
                const specialSpots = routesConfig[filter].specialSpots || [];
                const allRouteSpots = [...routeSpots, ...specialSpots];
                
                filteredSpots = spotsData.filter(spot => allRouteSpots.includes(spot.id));
            } else {
                // æŒ‰ route å±¬æ€§éæ¿¾
                filteredSpots = spotsData.filter(spot => spot.route === filter);
            }

            spotsList.innerHTML = filteredSpots.map(spot => {
                const isCollected = collection.some(c => c.id === spot.id);
                const isUnlocked = isSpecialUnlocked(spot);
                const isSpecial = spot.isSpecial;
                
                const difficultyInfo = {
                    'easy': { text: 'ç°¡å–®', color: '#4caf50', exp: 30 },
                    'normal': { text: 'æ™®é€š', color: '#ff9800', exp: 50 },
                    'hard': { text: 'å›°é›£', color: '#f44336', exp: 80 }
                };
                const diff = difficultyInfo[spot.difficulty];

                // éš±è—æ¬¾ç‰¹æ®Šè™•ç†
                const displayName = (isSpecial && !isUnlocked) ? spot.name : (spot.realName || spot.name);
                const cardClass = isSpecial && isUnlocked && !isCollected ? 'special-spot' : '';

                return `
                    <div class="spot-list-card ${isCollected ? 'collected' : ''} ${cardClass}" onclick="goToSpotDetail(${spot.id})">
                        <div class="spot-list-image" style="background: linear-gradient(135deg, ${getRouteColor(spot.route)});">
                            <i class="fas ${isSpecial ? 'fa-star' : spot.icon} fa-3x"></i>
                            ${isCollected ? '<div class="collected-badge"><i class="fas fa-check-circle"></i></div>' : ''}
                            ${isSpecial && !isUnlocked ? '<div class="locked-badge"><i class="fas fa-lock"></i> æœªè§£é–</div>' : ''}
                        </div>
                        <div class="spot-list-content">
                            <div class="spot-list-header">
                                <h3 class="spot-list-title">${displayName}</h3>
                                <span class="difficulty-badge" style="background: ${diff.color}">
                                    ${diff.text} +${spot.exp} EXP
                                </span>
                            </div>
                            <p class="spot-list-desc">${spot.shortDesc}</p>
                            <div class="spot-list-footer">
                                <div class="spot-list-info">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>${getRouteLabel(spot.route)}</span>
                                </div>
                                ${isCollected 
                                    ? '<span class="collected-label"><i class="fas fa-check"></i> å·²æ”¶é›†</span>'
                                    : (isSpecial && !isUnlocked)
                                        ? '<span class="go-checkin" style="background: #999;">ğŸ”’ éœ€è¦è§£é–</span>'
                                        : '<span class="go-checkin">å‰å¾€æ‰“å¡ <i class="fas fa-arrow-right"></i></span>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç¯©é¸åŠŸèƒ½
        function filterSpots(filter) {
            currentFilter = filter;
            
            // æ›´æ–°æ¨™ç±¤æ¨£å¼
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            
            // æ›´æ–°é é¢æ¨™é¡Œ
            const routeTitles = {
                'all': 'æ™¯é»åœ°åœ–',
                'nature': 'è‡ªç„¶æ¢ç´¢è·¯ç·š',
                'culture': 'è±ç”°æ–‡åŒ–è·¯ç·š',
                'special': 'éš±è—å¯¶è—è·¯ç·š'
            };
            document.getElementById('pageTitle').textContent = routeTitles[filter] || 'æ™¯é»åœ°åœ–';
            
            // é‡æ–°æ¸²æŸ“
            renderSpots(filter);
        }

        // å‰å¾€æ™¯é»è©³æƒ…
        function goToSpotDetail(spotId) {
            const spot = spotsData.find(s => s.id === spotId);
            
            // å¦‚æœæ˜¯éš±è—æ¬¾ä¸”æœªè§£é–ï¼Œé¡¯ç¤ºæç¤º
            if (spot && spot.isSpecial && !isSpecialUnlocked(spot)) {
                const requireSpot = spotsData.find(s => s.id === spot.unlockRequire);
                alert(`ğŸ”’ æ­¤æ™¯é»å°šæœªè§£é–ï¼\n\nè«‹å…ˆå®Œæˆã€Œ${requireSpot.name}ã€çš„æ‰“å¡ï¼Œå³å¯è§£é–æ­¤éš±è—æ™¯é»ã€‚`);
                return;
            }
            
            window.location.href = `spot-detail.html?id=${spotId}`;
        }

        // å–å¾—è·¯ç·šé¡è‰²
        function getRouteColor(route) {
            const colors = {
                'nature': '#66bb6a 0%, #43a047 100%',
                'culture': '#ffa726 0%, #fb8c00 100%',
                'special': '#42a5f5 0%, #1e88e5 100%'
            };
            return colors[route] || '#7cb342 0%, #aed581 100%';
        }

        // å–å¾—è·¯ç·šæ¨™ç±¤
        function getRouteLabel(route) {
            const labels = {
                'nature': 'è‡ªç„¶æ¢ç´¢',
                'culture': 'è±ç”°æ–‡åŒ–',
                'special': 'éš±è—å¯¶è—'
            };
            return labels[route] || 'æ™¯é»';
        }

        // åˆå§‹åŒ– - å¾ URL è®€å–è·¯ç·šåƒæ•¸
        const initialRoute = getRouteFromURL();
        currentFilter = initialRoute;
        
        // è¨­å®šåˆå§‹çš„ active æ¨™ç±¤
        if (initialRoute !== 'all') {
            document.querySelector('[data-filter="all"]').classList.remove('active');
            const targetTag = document.querySelector(`[data-filter="${initialRoute}"]`);
            if (targetTag) {
                targetTag.classList.add('active');
            }
        }
        
        // æ¸²æŸ“æ™¯é»
        renderSpots(initialRoute);
    </script>
</body>
</html>






